<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | Zampa Bridge</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            padding: 40px;
            background-color: #f4f4f4;
            color: #333;
        }

        .admin-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .tab-btn {
            padding: 10px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: bold;
            color: #888;
            border-radius: 4px;
        }

        .tab-btn.active {
            background: var(--primary-brand);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        textarea {
            height: 150px;
        }

        .list-item {
            background: #f9f9f9;
            padding: 15px;
            border: 1px solid #eee;
            margin-bottom: 15px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-save {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 20px;
        }

        .btn-delete {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .btn-add {
            background-color: var(--primary-brand);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>

    <div class="admin-container">
        <h1>Zampa Bridge CMS</h1>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('journey')">Journey</button>
            <button class="tab-btn" onclick="switchTab('episodes')">Episodes</button>
            <button class="tab-btn" onclick="switchTab('blog')">Blog</button>
        </div>

        <div id="msg" style="padding: 10px; margin-bottom: 20px; border-radius: 4px; display: none;"></div>

        <!-- Journey Tab -->
        <div id="journey" class="tab-content active">
            <h2>Edit Journey Page</h2>
            <div class="form-group">
                <label>Page Title</label>
                <input type="text" id="journey-title-input">
            </div>
            <div class="form-group">
                <label>Content (HTML allowed)</label>
                <textarea id="journey-content-input"></textarea>
            </div>
            <button class="btn-save" onclick="saveContent()">Save Changes</button>
        </div>

        <!-- Episodes Tab -->
        <div id="episodes" class="tab-content">
            <h2>Manage Episodes</h2>
            <button class="btn-add" onclick="createNewEpisode()">+ Add New Episode</button>
            <div id="episodes-list"></div>
            <button class="btn-save" onclick="saveContent()">Save Changes</button>
        </div>

        <!-- Blog Tab -->
        <div id="blog" class="tab-content">
            <h2>Manage Blog Posts</h2>
            <button class="btn-add" onclick="createNewBlog()">+ Add New Blog Post</button>
            <div id="blog-list"></div>
            <button class="btn-save" onclick="saveContent()">Save Changes</button>
        </div>
    </div>

    <script>
        let siteData = {};

        // Fetch Content on Load
        fetch('/api/content')
            .then(res => res.json())
            .then(data => {
                siteData = data;
                populateForms();
            });

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function populateForms() {
            // Journey
            if (siteData.journey) {
                document.getElementById('journey-title-input').value = siteData.journey.title;
                document.getElementById('journey-content-input').value = siteData.journey.content;
            }

            // Episodes
            const epList = document.getElementById('episodes-list');
            epList.innerHTML = '';
            if (siteData.episodes) {
                siteData.episodes.forEach((ep, index) => {
                    const div = document.createElement('div');
                    div.className = 'list-item';
                    div.innerHTML = `
                        <div style="flex-grow:1; margin-right:20px;">
                            <label>Title</label>
                            <input type="text" value="${ep.title}" onchange="updateEpisode(${index}, 'title', this.value)" style="margin-bottom:10px;">
                             <label>Description</label>
                            <input type="text" value="${ep.description}" onchange="updateEpisode(${index}, 'description', this.value)" style="margin-bottom:10px;">
                             <label>Video URL (Embed)</label>
                            <input type="text" value="${ep.videoUrl}" onchange="updateEpisode(${index}, 'videoUrl', this.value)">
                        </div>
                        <button class="btn-delete" onclick="deleteEpisode(${index})">Delete</button>
                    `;
                    epList.appendChild(div);
                });
            }

            // Blog
            const blogList = document.getElementById('blog-list');
            blogList.innerHTML = '';
            if (siteData.blog) {
                siteData.blog.forEach((post, index) => {
                    const div = document.createElement('div');
                    div.className = 'list-item';
                    div.innerHTML = `
                        <div style="flex-grow:1; margin-right:20px;">
                            <label>Title</label>
                            <input type="text" value="${post.title}" onchange="updateBlog(${index}, 'title', this.value)" style="margin-bottom:10px;">
                             <label>Date</label>
                            <input type="text" value="${post.date}" onchange="updateBlog(${index}, 'date', this.value)" style="margin-bottom:10px;">
                             <label>Summary</label>
                            <input type="text" value="${post.summary}" onchange="updateBlog(${index}, 'summary', this.value)">
                        </div>
                        <button class="btn-delete" onclick="deleteBlog(${index})">Delete</button>
                    `;
                    blogList.appendChild(div);
                });
            }
        }

        // --- Data Update Helpers ---

        // Journey
        document.getElementById('journey-title-input').addEventListener('input', (e) => siteData.journey.title = e.target.value);
        document.getElementById('journey-content-input').addEventListener('input', (e) => siteData.journey.content = e.target.value);

        // Episodes
        function updateEpisode(index, field, value) {
            siteData.episodes[index][field] = value;
        }
        function deleteEpisode(index) {
            if (confirm('Are you sure?')) {
                siteData.episodes.splice(index, 1);
                populateForms(); // Re-render
            }
        }
        function createNewEpisode() {
            siteData.episodes.push({ id: siteData.episodes.length + 1, title: "New Episode", description: "Desc", videoUrl: "" });
            populateForms();
        }

        // Blog
        function updateBlog(index, field, value) {
            siteData.blog[index][field] = value;
        }
        function deleteBlog(index) {
            if (confirm('Are you sure?')) {
                siteData.blog.splice(index, 1);
                populateForms(); // Re-render
            }
        }
        function createNewBlog() {
            siteData.blog.push({ id: siteData.blog.length + 1, date: "DATE", title: "New Post", summary: "Summary" });
            populateForms();
        }


        // Save to Server
        function saveContent() {
            fetch('/api/content', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(siteData)
            })
                .then(res => res.json())
                .then(data => {
                    const msg = document.getElementById('msg');
                    msg.style.display = 'block';
                    msg.style.background = '#d4edda';
                    msg.style.color = '#155724';
                    msg.innerText = 'Content Saved Successfully!';
                    setTimeout(() => msg.style.display = 'none', 3000);
                })
                .catch(err => {
                    const msg = document.getElementById('msg');
                    msg.style.display = 'block';
                    msg.style.background = '#f8d7da';
                    msg.style.color = '#721c24';
                    msg.innerText = 'Error Saving Content';
                });
        }
    </script>
</body>

</html>